# SPDX-FileCopyrightText:  gb-open-market-model contributors
#
# SPDX-License-Identifier: CC0-1.0

# docs in https://pypsa-eur.readthedocs.io/en/latest/configuration.html#run
run:
  name: "GB"

# docs in https://pypsa-eur.readthedocs.io/en/latest/configuration.html#foresight
foresight: overnight

scenario:
  clusters:
  - clustered
  - all
  opts:
  - ""
  sector_opts:
  - ""
  planning_horizons:
  - 2030

# docs in https://pypsa-eur.readthedocs.io/en/latest/configuration.html#countries
countries:
- "BE"
- "DK"
- "FR"
- "GB"
- "IE"
- "NL"
- "NO"

# docs in https://pypsa-eur.readthedocs.io/en/latest/configuration.html#enable
enable:
  retrieve: auto
  retrieve_databundle: true
  retrieve_cost_data: true
  build_cutout: false
  retrieve_cutout: true

# docs in https://pypsa-eur.readthedocs.io/en/latest/configuration.html#clustering
clustering:
  focus_weights: {NL: 0.01, "NO": 0.01, BE: 0.01, DK: 0.01, IE: 0.02, FR: 0.03, GB: 0.91}
  mode: gb_shapes

# docs in https://pypsa-eur.readthedocs.io/en/latest/configuration.html#solving
solving:
  options:
    load_shedding: false
  solver:
    name: gurobi
    options: gurobi-default

# docs in https://pypsa-eur.readthedocs.io/en/latest/configuration.html#electricity
electricity:
  powerplants_filter: (DateOut >= 2020 or DateOut != DateOut) and not (Country == 'Germany' and Fueltype == 'Nuclear')

urls:
  gb-etys-boundaries: https://api.neso.energy/dataset/997f4820-1ad4-499b-b1fe-4b8d3d7fbc72/resource/e914fcec-1dc9-4f1f-97e7-59c0d9521bea/download/etys-boundary-gis-data-mar25.zip
  transmission-availability: https://www.neso.energy/document/211021/download
  fes-2021-workbook: https://www.neso.energy/document/199971/download # FES 2021 workbook
  fes-2023-workbook: https://www.neso.energy/document/283061/download # FES 2023 workbook
  gsp-coordinates: https://api.neso.energy/dataset/963525d6-5d83-4448-a99c-663f1c76330a/resource/41fb4ca1-7b59-4fce-b480-b46682f346c9/download/fes2021_regional_breakdown_gsp_info.csv
  eur-supply-table: https://api.neso.energy/dataset/bd83ce0b-7b1e-4ff2-89e8-12d524c34d99/resource/6563801b-6da4-46e7-b147-3d81c0237779/download/fes2023_es2_v001.csv
target_crs: "EPSG:27700"
area_loss_tolerance_percent: 0.01 # percentage of area loss tolerated when splitting regions
min_region_area: 1000000 # minimum area of a region in square meters (1 kmÂ²) for keeping it after splitting

# Manual region merging configuration
region_operations:
  # Regions to split before merging
  splits:
  - region: 6
    type: "vertical"
    coordinate: -2.48
  - region: 5
    type: "vertical"
    coordinate: -1.93
  - region: 8
    type: "vertical"
    coordinate: -2.48
  - region: 46
    type: "horizontal"
    coordinate: 53.1

  # Groups of regions to merge together
  merge_groups:
  - [61, 64]
  - [47, 48, 49]
  - [54, 55, 56]
  - [52, 53]
  - [41, 43, "46s"]
  - [77, 78, 79]
  - [40, 44, 45]
  - [13, 16, 17]
  - [80, 81, 82, 83]
  - [18, 19, 20, 21, 22, 23, 24, 31, 32, 33, 34, 94, 95, 96, 97, 98]
  - [2, 3, 91, 92]
  - [14, 15, 25, 26, 27, 28, 29, 30, 35, 36, 37, 38]
  - [62, 63, 86, 87, 88]
  - [65, 66, 67, 68, 69, 70, 71, 72, 73, 84, 85]
  - [10, "6wn", 11, 12, "8w"]
  - ["6e", "6ws", 7, 9]
  - [39, 99]
  - [74, 75, 76]
  - [4, "5w"]

# Note: Set ENTSO_E_API_KEY in your .env file or environment variables
# Register at https://transparency.entsoe.eu/ to get API key
entsoe_unavailability:
  start_date: "2022-01-01"
  end_date: "2024-12-31"
  bidding_zones: ["GB"]  # Great Britain only
  business_types: ["planned", "forced"]  # planned maintenance and forced outages
  max_request_days: 120  # Maximum days per API request to avoid timeouts
  max_unavailable_days: 365 # Maximum days to consider an outage in availability profile generation.
  api_params:
    # UK bidding zone codes
    bidding_zones:
      GB: "10YGB----------A"  # Great Britain
    # Business types for outage classification
    business_types:
      planned: "A53"  # Planned maintenance
      forced: "A54"   # Forced unavailability (unplanned outage)
    # Document status codes
    doc_status:
      active: "A05"     # Active
      cancelled: "A09"  # Cancelled
      withdrawn: "A13"  # Withdrawn

  carrier_mapping: # Null values are those for which we don't plan to map data
    Bioenergy: biomass
    Lignite: lignite
    Natural Gas: gas
    Hard Coal: coal
    Oil: oil
    Geothermal: geothermal
    Pumped Hydro: PHS
    Run-Of-River: ror
    Reservoir: hydro
    Nuclear: nuclear
    Waste: waste

  resource_type_mapping:
    Fueltype:
      B01: Bioenergy  # Biomass
      B02: Lignite # "Fossil Brown coal/Lignite"
      B03: Hard Coal # "Fossil Coal-derived gas"
      B04: Natural Gas  # "Fossil Gas"
      B05: Hard Coal # "Fossil Hard coal"
      B06: Oil # "Fossil Oil"
      B07: Oil # "Fossil Oil shale"
      B09: Geothermal  # "Geothermal"
      B14: Nuclear  # "Nuclear"
      B17: Waste  # "Waste"
    Technology:
      B10: Pumped Storage # "Hydro Pumped Storage"
      B11: Run-Of-River # "Hydro Run-of-river and poundage"
      B12: Reservoir  # "Hydro Water Reservoir"

    ## unmapped
    # B08: "Fossil Peat"
    # B13: "Marine"
    # B15: "Other renewable"
    # B16: "Solar"
    # B18: "Wind Offshore"
    # B19: "Wind Onshore"
    # B20: "Other"
    # B21: "AC Link"
    # B22: "DC Link"
    # B23: "Substation"
    # B24: "Transformer"

fes-sheet-config:
  2021:
    SV.34:
      usecols: "I:AN"
      skiprows: 5
      index_col: 0
      header: 0
      rename:
        index: scenario
        columns: year

    BB1:
      usecols: "A:C,E,H:AK" # Ignore columns: "Baseline (2020)", "Share of GSP" (empty), "DNO License Area"
      skiprows: 0
      index_col: [0, 1, 2, 3]
      header: 0
      rename:
        columns: year

    # Annual H2 demand for industrial sector in GWh between 2021-2050
    CV.53:
      usecols: "O:BD"
      skiprows: 6
      index_col: 0
      header: 0
      rename:
        index: scenario
        columns: year

    # Annual H2 demand for commercial sector in GWh between 2021-2050
    CV.54:
      usecols: "O:BD"
      skiprows: 6
      index_col: 0
      header: 0
      rename:
        index: scenario
        columns: year

    # Annual H2 demand for home heating in TWh between 2021-2050
    CV.10:
      usecols: "M:AR"
      skiprows: 5
      index_col: 0
      header: 0
      rename:
        index: scenario
        columns: year

    # Annual road transport demand in TWh between 2021-2050
    CV.33:
      usecols: "M:AW"
      skiprows: 7
      index_col: 0
      header: 0
      rename:
        index: carrier
        columns: year

    # Annual H2 demand in TWh for 2050 only
    SV.12:
      usecols: "M:Q"
      skiprows: 5
      index_col: 0
      header: 0
      rename:
        index: H2_demand
        columns: scenario

    # Hourly dispatch profile for ASHP and H2 boilers in GWh for 1 day
    CV.21:
      usecols: "K:M"
      skiprows: 4
      index_col: 0
      header: 0
      rename:
        index: hour

    # Annual H2 production in TWh between 2021-2050
    SV.20:
      usecols: "M:AW"
      skiprows: 5
      index_col: 0
      header: 0
      rename:
        index: carrier
        columns: year

    # Annual electricity demand in TWh for non-grid connected electrolysis between 2021-2050
    ED1:
      usecols: "B:E,G:BA"
      skiprows: 4
      index_col: [0, 1, 2, 3]
      header: 0
      rename:
        columns: year

    # Annual hydrogen storage capacity in tonnes for 2020-2050
    FL.6:
      usecols: "K:O"
      skiprows: 9
      index_col: 0
      header: 0
      rename:
        index: year
        columns: scenario

    BB2:
      usecols: "A:E"
      skiprows: 2
      index_col: [0, 1, 3]
      header: 0
      rename:
        columns: Parameter

  2023:
    WS1:
      usecols: "A:D,H:AM" # Ignore columns: "Baseline (2022)", "Share of GSP" (empty), "DNO License Area"
      skiprows: 7
      index_col: [0, 1, 2, 3, 4]
      header: 0
      rename:
        columns: year

fes:
  year_range_incl: [2022, 2041] # 20-year period over which we will run the simulation
  default_set: PP
  gb:
    scenario: leading the way   # fes workbook
    scenario_abbreviations:
      leading the way: LW
      consumer transformation: CT
      system transformation: ST
      steady progression: SP
    carrier_mapping:
      # Mapping undertaken in different columns for different carriers
      Technology:
        Biomass & Energy Crops (including CHP): biomass
        CCGTs (non CHP): CCGT
        Coal: coal
        Geothermal: geothermal
        Hydro: ror # FIXME: should this be just "hydro?"
        Hydrogen fuelled generation: hydrogen  # FIXME: something else here?
        Marine: marine
        Non-renewable Engines (Diesel) (non CHP): oil
        Non-renewable Engines (Gas) (non CHP): gas
        Nuclear: nuclear
        OCGTs (non CHP): OCGT
        Offshore-Wind (off-Grid): offwind
        Renewable Engines (Landfill Gas, Sewage Gas, Biogas): biomass
        Solar Generation: solar
        Waste Incineration (including CHP): waste
      Technology Detail:
        Batteries: battery
        Pumped Hydro: PHS # FIXME: should this be just "hydro?"
        Offshore Wind: offwind
        Onshore Wind <1MW: onwind
        Onshore Wind >=1MW: onwind

    set_mapping:
      Technology:
        Biomass & Energy Crops (including CHP): CHP
        Waste Incineration (including CHP): CHP
        Non-renewable CHP: CHP
        Storage: Store
  eur:
    scenario: CT & LW    # "Leading the Way" equivalent in the NESO european supply table
    carrier_mapping:
      # Mapping undertaken in different columns for different carriers
      Type:
        Biomass: biomass
        Marine: marine
        Nuclear: nuclear
        Offshore Wind: offwind
        Onshore Wind: onwind
        Waste: waste
      SubType:
        CCS Biomass: biomass
        CCS Gas: gas
        CCGT: OCGT
        Gas CHP: CCGT
        OCGT: OCGT
        Gas Reciprocating Engines: gas
        Hydrogen: hydrogen # hydrogen-fueled turbine
        Fuel Oil: oil
        Battery: battery
        Pumped Hydro: PHS
      SubSubType:
        Coal: coal
        Coal CHP: coal
        IGCC: coal
        Lignite: lignite
        Lignite CHP: lignite
        Peat CHP: lignite
        Hydro: hydro
        Reservoir Hydro: hydro
        Reservoir Hydro with pumping: hydro
        Run-of-river Hydro: ror
        Small-Scale-Hydro: ror
        Geothermal: geothermal
        Solar PV: solar
        Solar CSP: csp

      ## unmapped
      # Other Renewables

    set_mapping:
      SubType:
        Biomass CHP: CHP
        Gas CHP: CHP
        Battery: Store
        Pumped Hydro: Store
      SubSubType:
        Coal CHP: CHP
        Lignite CHP: CHP
        Peat CHP: CHP
        Reservoir Hydro with pumping: Store

  hydrogen:
    demand:
      annual_demand_sheets:
        2021:
          industrial: CV.53
          commercial: CV.54
          residential: CV.10
          road transport: CV.33  # annual demand for Leading the Way scenario only
        2023:
          other: WS1
      other_sectors_list:
      - shipping and aviation
      - blending
      - direct air carbon capture and storage
      - transmission losses
    supply:
      supply_sheets:
        2021:
          hydrogen_supply: SV.20
          electricity_demand: ED1
      exogeneous_supply_list:
      - non-networked electrolysis
      - beccs
      - imports
    storage:
      storage_sheets:
        2021:
          storage_capacity: FL.6
      interpolation_method: linear  # Options: linear, s_curve, step. Interpolation method for hydrogen storage capacity between FES years

interconnectors:
  # lat/lon values are approximate.
  # Some are based on the proposed connecting substation from the UK interconnector register.
  # Others are based on visual inspection of the TYNDP map.

  # Where the interconnection register provides a different import/export maximum, the value with one significant figure has been chosen (e.g. 1000 instead of 975, 700 instead of 730).
  options:
  - name: Nemo
    neighbour: Belgium
    capacity_mw: 1000
    tyndp:
      id: 74
      year: [2016, 2018]
    lat: 51.31128166242589
    lon: 1.3452723677851797

  - name: Cronos
    neighbour: Belgium
    capacity_mw: 1400
    tyndp:
      id: 1049
      year: [2020, 2022, 2024]
    lat: 51.36845232119477
    lon: 0.7414853093448239

  - name: Nautilus
    neighbour: Belgium
    capacity_mw: 1500
    tyndp:
      id: 121
      year: [2018, 2020, 2022, 2024]   # similar location to Cronos
    lat: 51.36845232119477
    lon: 0.7414853093448239

  - name: Viking Link
    neighbour: Denmark
    capacity_mw: 1400
    tyndp:
      id: 167
      year: [2016, 2018, 2020]
    lat: 52.921019
    lon: -0.236528

  - name: Aminth
    neighbour: Denmark
    capacity_mw: 1400
    tyndp:
      id: 1051
      year: [2020, 2022]
    lat: 52.785930
    lon: 1.603520

  - name: IFA
    neighbour: France
    capacity_mw: 2000
    tyndp:
      id:
      year: []
    lat: 50.818266
    lon: -1.194752

  - name: IFA2
    neighbour: France
    capacity_mw: 1000
    tyndp:
      id: 25
      year: [2016, 2018]
    lat: 50.818266
    lon: -1.194752

  - name: ElecLink
    neighbour: France
    capacity_mw: 1000
    tyndp:
      id: 172
      year: [2016, 2018, 2020]
    lat: 51.106623
    lon: 0.976183

  - name: Aquind
    neighbour: France
    capacity_mw: 2075
    tyndp:
      id: 247
      year: [2016, 2018, 2020, 2022, 2024]
    lat: 50.917413
    lon: -1.039947

  - name: Gridlink
    neighbour: France
    capacity_mw: 1250
    tyndp:
      id: 285
      year: [2016, 2018, 2020, 2022, 2024]
    lat: 51.418566
    lon: 0.598536

  - name: Kulizumboo
    neighbour: France
    capacity_mw: 700
    tyndp:
      id:
      year: []
    lat: 51.2946968873797
    lon: 1.0972526447850766

  - name: FAB Link
    neighbour: France
    capacity_mw: 1250
    tyndp:
      id: 153
      year: [2014, 2016, 2018, 2020, 2022, 2024]
    lat: 50.76969783229996
    lon: -3.403440324550243

  - name: NeuConnect
    neighbour: Germany
    capacity_mw: 1470
    tyndp:
      id: 309
      year: [2018, 2020, 2022, 2024]
    lat: 51.339838
    lon: 0.893931

  - name: Tarchon
    neighbour: Germany
    capacity_mw: 1400
    tyndp:
      id: 1050
      year: [2020, 2022, 2024]
    lat: 51.916412
    lon: 0.950332

  - name: East-West
    neighbour: Ireland
    capacity_mw: 585
    tyndp:
      id:
      year: []
    lat: 53.227149
    lon: -3.072706

  - name: Greenlink (Greenwire)
    neighbour: Ireland
    capacity_mw: 524
    tyndp:
      id: 286
      year: [2016, 2018, 2020, 2022]
    lat: 51.682162
    lon: -4.989479

  - name: Gallant
    neighbour: Ireland    # Northern Ireland
    capacity_mw: 500
    tyndp:
      id: 295
      year: [2016]   # Assigning same as Moyle
    lat: 55.069696
    lon: -4.980757

  - name: Moyle
    neighbour: Ireland    # Northern Ireland
    capacity_mw: 1000
    tyndp:
      id:
      year: []
    lat: 55.069696
    lon: -4.980757

  - name: MARES
    neighbour: Ireland
    capacity_mw: 750
    tyndp:
      id: 349
      year: [2018, 2020, 2022, 2024]
    lat: 53.249980
    lon: -3.474123

  - name: LirIC
    neighbour: Ireland
    capacity_mw: 700
    tyndp:
      id: 1040
      year: [2020, 2022, 2024]
    lat: 55.720041
    lon: -4.890811

  - name: BritNed
    neighbour: Netherlands
    capacity_mw: 1200
    tyndp:
      id:
      year: []
    lat: 51.440498
    lon: 0.716158

  - name: LionLink (EuroLink)
    neighbour: Netherlands
    capacity_mw: 1600
    tyndp:
      id:
      year: []
    lat: 52.208337
    lon: 1.612194

  - name: SENECA
    neighbour: Netherlands
    capacity_mw: 1254
    tyndp:
      id:
      year: []
    lat: 53.29937953918448
    lon: 0.19505891766556116

  - name: NS Link (NSL)
    neighbour: Norway
    capacity_mw: 1480
    tyndp:
      id: 110
      year: [2018, 2020]
    lat: 55.141172
    lon: -1.531373

  - name: Maali
    neighbour: Norway
    capacity_mw: 600
    tyndp:
      id: 294
      year: [2016, 2018]
    lat: 60.293767
    lon: -1.271974

  - name: NorthConnect
    neighbour: Norway
    capacity_mw: 1400
    tyndp:
      id: 190
      year: [2014, 2016, 2018, 2020, 2022]
    lat: 57.476438
    lon: -1.800696

  - name: Continental Link
    neighbour: Norway
    capacity_mw: 1800
    tyndp:
      id:
      year: []
      # "700m north of existing Creyke Beck Substation"
      # https://www.nationalgrid.com/electricity-transmission/network-and-infrastructure/infrastructure-projects/creyke-beck-substation-extension
    lat: 53.81322
    lon: -0.41847
  plan:
    2021: [East-West, IFA, IFA2, NS Link (NSL), Nemo] # existing
    2022: [Moyle, Greenlink (Greenwire)]
    2023: [Viking Link]
    2025: [ElecLink, LionLink (EuroLink), Aminth]
    2026: [NeuConnect]
    2027: [MARES, Nautilus, Gallant, NorthConnect]
    2030: [Cronos, Tarchon]
    2033: [Kulizumboo, SENECA, FAB Link, Gridlink, LirIC]
    2037: [Continental Link]
